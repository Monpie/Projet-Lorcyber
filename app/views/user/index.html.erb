<% if @current_user %>
  <% if Droit.find(@current_user.droit_id).role == "admin"  %>
    <h1>Pages users
    </h1>
    <h2>Créer utilisateur
    </h2>

    <%= flash[:password_error]%>
    <p>
      <%= form_tag "/user/create", method: :post do %>
      <p>
        <label>Nom de l'utilisateur :
        </label>
        <input type="text" name="nom"/>
      </p>
      <p>
        <label>Mot de passe de l'utilisateur :</label>
        <input type="password" name="password"/>
        <p>
          <label>Droit de l'utilisateur</label>
          <select name="role">
            <% @droits.each do |droit| %>
              <% if droit.role == "utilisateur" %>
                <option value="<%=droit.id%>" selected="selected"><%=droit.role%></option>
              <% else %>
                <option value="<%=droit.id%>"><%=droit.role%></option>
              <% end %>
            <% end %>
          </select>
        </p>

        <input type="submit" value="Valider"/>
      <% end %>

    </p>

    <table class="table table-hover">
      <tr>
        <th>Id</th>
        <th>Nom</th>
        <th>Droits</th>
      </tr>
      <% @Utilisateurs.each do |utilisateur| %>
        <tr>
          <td><%= utilisateur.id %></td>
          <td><%= utilisateur.nom %></td>
          <td><%= Droit.find(utilisateur.droit_id).role %></td>
          <td>
            <a href="/user/show?id=<%=utilisateur.id%>">
              <button>edit</button>
            </a>
          </td>
          <td>
            <a href="/user/delete?id=<%=utilisateur.id%>">x</a>
          </td>
        </tr>
      <% end %>
    <% else %>
      <p>Vous n'avez pas les droits requis pour accéder à cette page
      </p>
      <%= link_to 'Accueil', welcome_index_path %>
    <% end %>
  <% else %>
    <p>Vous devez être connecté pour pouvoir accéder à cette page</p>
    <%= link_to 'Accueil', welcome_index_path %>
  <% end %>
